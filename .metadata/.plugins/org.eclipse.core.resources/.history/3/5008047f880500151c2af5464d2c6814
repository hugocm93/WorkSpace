package Interface;

import java.awt.Graphics;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.awt.event.FocusListener;
import java.awt.image.BufferedImage;
import java.io.File;
import java.io.IOException;

import javax.imageio.ImageIO;
import javax.swing.ImageIcon;
import javax.swing.JButton;
import javax.swing.JOptionPane;
import javax.swing.JPanel;
import javax.swing.JTextField;

import Controladores.Controlador;

import org.imgscalr.Scalr;

public class PainelTelaInicial extends JPanel implements ActionListener, FocusListener{
	
	private static final long serialVersionUID = 1L;
	private String path1 = System.getProperty("user.dir");
	private String path2 = "/src/zImagens/Background/";
	private String path3 = "/src/zImagens/Pinos/";
	private BufferedImage imgMapa;
	private BufferedImage imgTitulo;
	private BufferedImage imgPlay;
	private BufferedImage[] pinos = new BufferedImage[6];;
	private JButton botaoPlay = new JButton();
	private JTextField[] jogadoresTexto  = new JTextField[]{new JTextField(20),new JTextField(20),new JTextField(20),new JTextField(20),new JTextField(20),new JTextField(20)};
	private String[] cores;
	
	public PainelTelaInicial(){
		
		try {
			File imgMapaFile = new File(path1 + path2 + "war_tabuleiro_fundo.png");
			imgMapa = ImageIO.read(imgMapaFile);
			
			File imgTituloFile = new File(path1 + path2 + "war_titulo.png");
			imgTitulo = ImageIO.read(imgTituloFile);
			
			File imgPlayFile = new File(path1 + path2 + "war_play.png");
			imgPlay = ImageIO.read(imgPlayFile);
			
			cores = new String[]{"vermelho.png","verde.png","amarelo.png","azul.png","branco.png","preto.png"};
			File[] imgPinoFile = new File[]{new File(path1 + path3 + cores[0]),new File(path1 + path3 + cores[1]),new File(path1 + path3 + cores[2]),new File(path1 + path3 + cores[3]),new File(path1 + path3 + cores[4]),new File(path1 + path3 + cores[5])};
			
			for(int i=0;i<6;i++){
				pinos[i] = ImageIO.read(imgPinoFile[i]);
			}
		}
		
		catch (IOException e) {
			System.out.println("Imagem não encontrada.");
		}
		
		botaoPlay.setIcon(new ImageIcon(Scalr.resize(imgPlay, 100)));
		botaoPlay.addActionListener(this);
		this.add(botaoPlay);
		botaoPlay.setVisible(true);
		botaoPlay.setOpaque(false);
		botaoPlay.setContentAreaFilled(false);
		botaoPlay.setBorderPainted(false);
		
		for(int i=0;i<2;i++){
			for(int j=0;j<3;j++){
				this.add(jogadoresTexto[j+i*3]);
				jogadoresTexto[j+i*3].setVisible(true);
				
			}
		}

		this.repaint();
	}
	
	public void paintComponent(Graphics g) {
		super.paintComponents(g);
		
		g.drawImage(imgMapa, 0, - Constantes.getDeslocamento(), Constantes.getLargura(), Constantes.getAltura() , null);
		g.drawImage(imgTitulo, 0, -5, Constantes.getLargura() + 5,Math.round(imgTitulo.getHeight()/Constantes.getConstConversao()) , null);
		botaoPlay.setBounds(Constantes.getLargura() - imgPlay.getWidth()/3 ,  Constantes.getAltura() - imgPlay.getHeight()/2, imgPlay.getWidth()/4, imgPlay.getHeight()/4);
		
		for(int i=0;i<2;i++){
			for(int j=0;j<3;j++){
				
				g.drawImage(pinos[j+i*3], i*400+70, j*170+150, 65, 65 , null);
				jogadoresTexto[j+i*3].setBounds(i*400+150,j*170+170,170,30);
				jogadoresTexto[j+i*3].setText(String.format("Nome do jogador %d", j+i*3+1));
			}
		}
		g.finalize();
    }

	public void actionPerformed(ActionEvent e) {
		if(e.getSource() == botaoPlay){
			
			int contJogadores = 0;
			for(int i=0;i<2;i++){
				for(int j=0;j<3;j++){
					if(jogadoresTexto[j+i*3].getText() != String.format("Nome do jogador %d", j+i*3+1)){
						System.out.println("#" + jogadoresTexto[j+i*3].getText() + "#" + String.format("Nome do jogador %d", j+i*3+1) + "#");
						Controlador.criaNovoJogador(jogadoresTexto[j+i*3].getText(), cores[j+i*3]);
						contJogadores++;
					}
				}
			}
			if(contJogadores>3){
				System.out.println(contJogadores);
				Controlador.criaPainelMapa();
				Controlador.irPainelMapa();
			}
			else{
				JOptionPane.showMessageDialog(null, "O número mínimo de jogadores é 3.");
			}
		}
	}
}
