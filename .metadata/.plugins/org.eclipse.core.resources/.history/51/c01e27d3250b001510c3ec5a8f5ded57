package Controladores;

import java.awt.BorderLayout;
import java.awt.Color;
import java.awt.Point;
import java.awt.event.MouseEvent;
import java.awt.image.BufferedImage;

import javax.swing.ImageIcon;
import javax.swing.JFrame;

import Interface.*;
import Modelos.*;

public abstract class Controlador {

	private static JFrame janela;
	private static FrameDados frameDados;
	private static FrameFimDaJogada frameFimDaJogada;
	private static PainelTelaInicial painelTelaInicial;
	private static PainelMapa painelMapa;
	private static PainelOpcoes painelOpcoes;
	private static Mundo mundo;
	private static Territorio clicado ;


	public static void criaMundo(){
		mundo = new Mundo();
	}


	//////Inicio dos metodos relacionados com o fluxo de execucao******************************
	
	//////Fim dos metodos relacionados com o fluxo de execucao******************************






	//////Inicio dos metodos relacionados com o painelMapa************************************************
	public static String detectaTerritorio(MouseEvent e, BufferedImage imgMapa){
		int packedInt = imgMapa.getRGB(Math.round(e.getX()*Constantes.getConstConversao2()), Math.round((e.getY() + Constantes.getDeslocamento())*Constantes.getConstConversao() - Constantes.getDeslocamento()/2));
		Color color = new Color(packedInt, true);

		//      System.out.printf("(%d,%d,%d)\n", color.getRed(),color.getGreen(),color.getBlue());
		//		System.out.printf("new Point(%d,%d),", Math.round(e.getX()*constConversaoX), Math.round(e.getY()*constConversaoY));

		int j;
		for(j=0 ; j<6 && mundo.getContinentes()[j].getCor().equals(new Cor(color.getRed(),color.getGreen(),color.getBlue())) == false;j++){
			//			System.out.printf("%d %d %d - %d %d %d\n", mundo.getContinentes()[j].getCor().getR(),mundo.getContinentes()[j].getCor().getG(),mundo.getContinentes()[j].getCor().getB(),color.getRed(),color.getGreen(),color.getBlue());
		}

		if(j<6 && mundo.getContinentes()[j].getCor().equals(new Cor(color.getRed(),color.getGreen(),color.getBlue())) == true){
			return Controlador.percorre(e, j);
		}

		else{
			for(int k=0 ; j<mundo.getContinentes().length ;k++)
				return Controlador.percorre(e, k);
		}
		
		return null;
	}

	private static String percorre(MouseEvent e, int j){

		for(int i=0 ; i<mundo.getContinentes()[j].getTerritorios().length ; i++){
			if(mundo.getContinentes()[j].getTerritorios()[i].getPoligono().dentroPolig(new Point( Math.round(e.getX()/Constantes.getConstConversaoX()),Math.round((e.getY())/Constantes.getConstConversaoY())+ Constantes.getDeslocamento2()-Constantes.getConstMagica())) == true){
				System.out.println(mundo.getContinentes()[j].getTerritorios()[i].getNome());
				clicado = mundo.getContinentes()[j].getTerritorios()[i];
				return mundo.getContinentes()[j].getTerritorios()[i].getNome();
			}
		}
		clicado = null;
		return null;
	}

	public static Territorio getTerritorioClicado (){
		return clicado;
	}
	//////Fim dos metodos relacionados com o painelMapa*************************************************





	//////Inicio dos metodos relacionados com o painelTelaInicial************************************************
	public static void criaNovoJogador(String nome, String cor){
		mundo.insereNovoJogador(new Jogador(nome, cor, null, null, null, null));
	}
	//////Inicio dos metodos relacionados com o painelTelaInicial************************************************






	//////Inicio dos metodos relacionados com o frameDados************************************************

	public static  void jogarDadosAtaque(int nExercitosAtaque){
		
		for(int i=0;i<3;i++){
			mundo.getDadosAtaque()[i].reseta();
		}
		
		if(nExercitosAtaque<=3){
			for(int i=0;i<nExercitosAtaque-1;i++){
				mundo.getDadosAtaque()[i].rolar_dado();
			}
		}
		else{
			for(int i=0;i<3;i++){
				mundo.getDadosAtaque()[i].rolar_dado();
			}
		}
		
	}
	
public static void jogarDadosDefesa(int nExercitosDefesa){
		
		for(int i=0;i<3;i++){
			mundo.getDadosDefesa()[i].reseta();
		}
		
		if(nExercitosDefesa<=3){
			for(int i=0;i<nExercitosDefesa;i++){
				mundo.getDadosDefesa()[i].rolar_dado();
			}
		}
		else{
			for(int i=0;i<3;i++){
				mundo.getDadosDefesa()[i].rolar_dado();
			}
		}
		
	}
	
	public static ImageIcon[] getNomesDasImagensDosDadosDeAtaque(){
		ImageIcon[] ret = new ImageIcon[3];
		
		for(int i=0;i<3;i++){
			ret[i] = mundo.getDadosAtaque()[i].getIcon();
		}
		
		return ret;
	}
	
	public static ImageIcon[] getNomesDasImagensDosDadosDeDefesa(){
		ImageIcon[] ret = new ImageIcon[3];
		
		for(int i=0;i<3;i++){
			ret[i] = mundo.getDadosDefesa()[i].getIcon();
		}
		
		return ret;
	}
	//////Fim dos metodos relacionados com o frameDados************************************************

	public static void ordenarDadosDeAtaque() {
		// TODO Auto-generated method stub
		
		mundo.ordenarDados(TipoDado.ATAQUE);
		
	}
	
	public static void ordenarDadosDeDefesa() {
		// TODO Auto-generated method stub
		
		mundo.ordenarDados(TipoDado.DEFESA);
		
	}

}
